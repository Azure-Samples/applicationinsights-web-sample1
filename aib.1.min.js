/*!
 * Application Insights JavaScript Web SDK - Basic, 2.0.0-beta.1
 * Copyright (c) Microsoft and contributors. All rights reserved.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e.Microsoft=e.Microsoft||{},e.Microsoft.ApplicationInsights={}))}(this,function(e){"use strict";var g,t,n=2,m=function(){function e(){}return e.isNullOrUndefined=function(e){return null==e},e.newGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(i,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},e}(),i=/[xy]/g,c=function(){function e(){this.listeners=[]}return e.prototype.addNotificationListener=function(e){this.listeners.push(e)},e.prototype.removeNotificationListener=function(e){for(var t=this.listeners.indexOf(e);-1<t;)this.listeners.splice(t,1),t=this.listeners.indexOf(e)},e.prototype.eventsSent=function(t){for(var n=this,e=function(e){i.listeners[e].eventsSent&&setTimeout(function(){return n.listeners[e].eventsSent(t)},0)},i=this,r=0;r<this.listeners.length;++r)e(r)},e.prototype.eventsDiscarded=function(t,n){for(var i=this,e=function(e){r.listeners[e].eventsDiscarded&&setTimeout(function(){return i.listeners[e].eventsDiscarded(t,n)},0)},r=this,o=0;o<this.listeners.length;++o)e(o)},e}();(t=g||(g={}))[t.CRITICAL=1]="CRITICAL",t[t.WARNING=2]="WARNING";var r=1,o=2,a=3,u=4,l=5,f=6,s=7,v=8,y=10,p=12,d=22,h=23,_=24,I=26,S=28,w=40,b=41,E=42,x=43,N=45,T=46,C=47,D=48,A=49,R=50,L=52,M=54,U=56,O=57,P=61,z=64,k=66,B=67,q=68,V=69,F=function(){function o(e,t,n,i){void 0===n&&(n=!1),this.messageId=e,this.message=(n?o.AiUserActionablePrefix:o.AiNonUserActionablePrefix)+e;var r=(t?" message:"+o.sanitizeDiagnosticText(t):"")+(i?" props:"+o.sanitizeDiagnosticText(JSON.stringify(i)):"");this.message+=r}return o.sanitizeDiagnosticText=function(e){return'"'+e.replace(/\"/g,"")+'"'},o.dataType="MessageData",o.AiNonUserActionablePrefix="AI (Internal): ",o.AiUserActionablePrefix="AI: ",o}(),G=function(){function e(e){this.AIInternalMessagePrefix="AITR_",this.enableDebugExceptions=function(){return!1},this.consoleLoggingLevel=function(){return 1},this.telemetryLoggingLevel=function(){return 0},this.maxInternalMessageLimit=function(){return 25},this.queue=[],this._messageCount=0,this._messageLogged={},m.isNullOrUndefined(e)||(m.isNullOrUndefined(e.loggingLevelConsole)||(this.consoleLoggingLevel=function(){return e.loggingLevelConsole}),m.isNullOrUndefined(e.loggingLevelTelemetry)||(this.telemetryLoggingLevel=function(){return e.loggingLevelTelemetry}),m.isNullOrUndefined(e.maxMessageLimit)||(this.maxInternalMessageLimit=function(){return e.maxMessageLimit}),m.isNullOrUndefined(e.enableDebugExceptions)||(this.enableDebugExceptions=function(){return e.enableDebugExceptions}))}return e.prototype.throwInternal=function(e,t,n,i,r){void 0===r&&(r=!1);var o=new F(t,n,r,i);if(this.enableDebugExceptions())throw o;if(void 0!==o&&o&&void 0!==o.message){if(r){var a=+o.messageId;(!this._messageLogged[a]||this.consoleLoggingLevel()>=g.WARNING)&&(this.warnToConsole(o.message),this._messageLogged[a]=!0)}else this.consoleLoggingLevel()>=g.WARNING&&this.warnToConsole(o.message);this.logInternalMessage(e,o)}},e.prototype.warnToConsole=function(e){"undefined"!=typeof console&&console&&("function"==typeof console.warn?console.warn(e):"function"==typeof console.log&&console.log(e))},e.prototype.resetInternalMessageCount=function(){this._messageCount=0,this._messageLogged={}},e.prototype.logInternalMessage=function(e,t){if(!this._areInternalMessagesThrottled()){var n=!0,i=this.AIInternalMessagePrefix+t.messageId;if(this._messageLogged[i]?n=!1:this._messageLogged[i]=!0,n&&(e<=this.telemetryLoggingLevel()&&(this.queue.push(t),this._messageCount++),this._messageCount==this.maxInternalMessageLimit())){var r="Internal events throttle limit per PageView reached for this app.",o=new F(h,r,!1);this.queue.push(o),this.warnToConsole(r)}}},e.prototype._areInternalMessagesThrottled=function(){return this._messageCount>=this.maxInternalMessageLimit()},e}(),X=function(){function e(){this._isInitialized=!1,this._extensions=new Array,this._channelController=new H}return e.prototype.initialize=function(e,t){var n=this;if(this._isInitialized)throw Error("Core should not be initialized more than once");if(!e||m.isNullOrUndefined(e.instrumentationKey))throw Error("Please provide instrumentation key");if(this.config=e,this._notificationManager=new c,this.config.extensions=m.isNullOrUndefined(this.config.extensions)?[]:this.config.extensions,this.config.extensionConfig=m.isNullOrUndefined(this.config.extensionConfig)?{}:this.config.extensionConfig,this.config.extensionConfig.NotificationManager=this._notificationManager,this.logger=new G(e),t.forEach(function(e){if(m.isNullOrUndefined(e.initialize))throw Error(j)}),0<this.config.extensions.length){var i=!0,r=!1;if(this.config.extensions.forEach(function(e){m.isNullOrUndefined(e)&&(i=!1),e.priority>W&&(r=!0)}),!i)throw Error(j);if(r)throw Error(K)}(a=this._extensions).push.apply(a,[this._channelController].concat(t,this.config.extensions)),this._extensions=this._extensions.sort(function(e,t){var n=e,i=t,r=typeof n.processTelemetry,o=typeof i.processTelemetry;return"function"===r&&"function"===o?n.priority-i.priority:"function"===r&&"function"!==o?1:"function"!==r&&"function"===o?-1:void 0});var o={};this._extensions.forEach(function(e){var t=e;t&&t.priority&&(m.isNullOrUndefined(o[t.priority])?o[t.priority]=t.identifier:n.logger.warnToConsole("Two extensions have same priority"+o[t.priority]+", "+t.identifier))});for(var a,s=-1,u=0;u<this._extensions.length-1;u++){var l=this._extensions[u];if(!l||"function"==typeof l.processTelemetry){if(l.priority===W){s=u+1;break}this._extensions[u].setNextPlugin(this._extensions[u+1])}}if(this._channelController.initialize(this.config,this,this._extensions),this._extensions.forEach(function(e){e&&e.priority<W&&e.initialize(n.config,n,n._extensions)}),s<this._extensions.length&&this._extensions.splice(s),0===this.getTransmissionControls().length)throw new Error("No channels available");this._isInitialized=!0},e.prototype.getTransmissionControls=function(){return this._channelController.ChannelControls},e.prototype.track=function(e){if(null===e)throw this._notifiyInvalidEvent(e),Error("Invalid telemetry item");if(e.baseData&&!e.baseType)throw this._notifiyInvalidEvent(e),Error("Provide data.baseType for data.baseData");e.baseType||(e.baseType="EventData"),e.iKey||(e.iKey=this.config.instrumentationKey),e.time||(e.time=(new Date).toISOString()),m.isNullOrUndefined(e.ver)&&(e.ver="4.0"),this._validateTelmetryItem(e),this._updateSdkVersion(e);for(var t=0;t<this._extensions.length;){if(this._extensions[t].processTelemetry){this._extensions[t].processTelemetry(e);break}t++}},e.prototype.addNotificationListener=function(e){this._notificationManager.addNotificationListener(e)},e.prototype.removeNotificationListener=function(e){this._notificationManager.removeNotificationListener(e)},e.prototype.pollInternalLogs=function(){var n=this,e=this.config.diagnosticLogInterval;return 0<e||(e=1e4),setInterval(function(){var e=n.logger.queue;e.forEach(function(e){var t={name:"InternalMessageId: "+e.messageId,iKey:n.config.instrumentationKey,time:(new Date).toISOString(),baseType:F.dataType,baseData:{message:e.message}};n.track(t)}),e.length=0},e)},e.prototype._validateTelmetryItem=function(e){if(m.isNullOrUndefined(e.name))throw this._notifiyInvalidEvent(e),Error("telemetry name required");if(m.isNullOrUndefined(e.time))throw this._notifiyInvalidEvent(e),Error("telemetry timestamp required");if(m.isNullOrUndefined(e.iKey))throw this._notifiyInvalidEvent(e),Error("telemetry instrumentationKey required")},e.prototype._updateSdkVersion=function(e){e.ext||(e.ext={}),e.ext.sdk||(e.ext.sdk={});for(var t="",n=0;n<this._extensions.length;n++){var i=this._extensions[n];if(i.identifier&&i.version){var r=i.identifier+":"+i.version+";";t=t.concat(r)}}""!=t&&(e.ext.sdk.libVer=t)},e.prototype._notifiyInvalidEvent=function(e){this._notificationManager.eventsDiscarded([e],n)},e}(),H=function(){function e(){this.identifier="ChannelControllerPlugin",this.priority=W}return e.prototype.processTelemetry=function(t){this.channelQueue.forEach(function(e){0<e.length&&e[0].processTelemetry(t)})},Object.defineProperty(e.prototype,"ChannelControls",{get:function(){return this.channelQueue},enumerable:!0,configurable:!0}),e.prototype.initialize=function(n,i,r){var o=this;if(this.channelQueue=new Array,n.channels){var a=void 0;n.channels.forEach(function(e){if(e&&0<e.length){if((e=e.sort(function(e,t){return e.priority-t.priority})).forEach(function(e){e.priority<W&&(a=e.identifier),e.initialize(n,i,r)}),a)throw Error(Y+a);for(var t=1;t<e.length;t++)e[t-1].setNextPlugin(e[t]);o.channelQueue.push(e)}})}for(var e=new Array,t=0;t<r.length;t++){var s=r[t];s.priority>W&&e.push(s)}if(0<e.length){(e=e.sort(function(e,t){return e.priority-t.priority})).forEach(function(e){return e.initialize(n,i,r)});for(t=1;t<e.length;t++)e[t-1].setNextPlugin(e[t]);this.channelQueue.push(e)}},e}(),j="Extensions must provide callback to initialize",K="Channels must be provided through config.channels only",W=500,Y="Channel has invalid priority",J=function(e,t){return(J=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function Z(e,t){function n(){this.constructor=e}J(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var Q,$,ee,te,ne=function(){return(ne=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};($=Q||(Q={}))[$.LocalStorage=0]="LocalStorage",$[$.SessionStorage=1]="SessionStorage",(te=ee||(ee={}))[te.Default=0]="Default",te[te.Required=1]="Required",te[te.Array=2]="Array",te[te.Hidden=4]="Hidden";var ie,re,oe=function(){function e(){}return e.requestContextHeader="Request-Context",e.requestContextTargetKey="appId",e.requestContextAppIdFormat="appId=cid-v1:",e.requestIdHeader="Request-Id",e.sdkContextHeader="Sdk-Context",e.sdkContextHeaderAppIdRequest="appId",e.requestContextHeaderLowerCase="request-context",e}(),ae=function(){function s(){}return s.sanitizeKeyAndAddUniqueness=function(e,t,n){var i=t.length,r=s.sanitizeKey(e,t);if(r.length!==i){for(var o=0,a=r;void 0!==n[a];)o++,a=r.substring(0,s.MAX_NAME_LENGTH-3)+s.padNumber(o);r=a}return r},s.sanitizeKey=function(e,t){return t&&(t=s.trim(t.toString())).length>s.MAX_NAME_LENGTH&&(t=t.substring(0,s.MAX_NAME_LENGTH),e.throwInternal(g.WARNING,O,"name is too long.  It has been truncated to "+s.MAX_NAME_LENGTH+" characters.",{name:t},!0)),t},s.sanitizeString=function(e,t,n){return void 0===n&&(n=s.MAX_STRING_LENGTH),t&&(n=n||s.MAX_STRING_LENGTH,(t=s.trim(t)).toString().length>n&&(t=t.toString().substring(0,n),e.throwInternal(g.WARNING,P,"string value is too long. It has been truncated to "+n+" characters.",{value:t},!0))),t},s.sanitizeUrl=function(e,t){return s.sanitizeInput(e,t,s.MAX_URL_LENGTH,k)},s.sanitizeMessage=function(e,t){return t&&t.length>s.MAX_MESSAGE_LENGTH&&(t=t.substring(0,s.MAX_MESSAGE_LENGTH),e.throwInternal(g.WARNING,U,"message is too long, it has been truncated to "+s.MAX_MESSAGE_LENGTH+" characters.",{message:t},!0)),t},s.sanitizeException=function(e,t){return t&&t.length>s.MAX_EXCEPTION_LENGTH&&(t=t.substring(0,s.MAX_EXCEPTION_LENGTH),e.throwInternal(g.WARNING,L,"exception is too long, it has been truncated to "+s.MAX_EXCEPTION_LENGTH+" characters.",{exception:t},!0)),t},s.sanitizeProperties=function(e,t){if(t){var n={};for(var i in t){var r=s.sanitizeString(e,t[i],s.MAX_PROPERTY_LENGTH);n[i=s.sanitizeKeyAndAddUniqueness(e,i,n)]=r}t=n}return t},s.sanitizeMeasurements=function(e,t){if(t){var n={};for(var i in t){var r=t[i];n[i=s.sanitizeKeyAndAddUniqueness(e,i,n)]=r}t=n}return t},s.sanitizeId=function(e,t){return t?s.sanitizeInput(e,t,s.MAX_ID_LENGTH,V).toString():t},s.sanitizeInput=function(e,t,n,i){return t&&(t=s.trim(t)).length>n&&(t=t.substring(0,n),e.throwInternal(g.WARNING,i,"input is too long, it has been truncated to "+n+" characters.",{data:t},!0)),t},s.padNumber=function(e){var t="00"+e;return t.substr(t.length-3)},s.trim=function(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"")},s.MAX_NAME_LENGTH=150,s.MAX_ID_LENGTH=128,s.MAX_PROPERTY_LENGTH=8192,s.MAX_STRING_LENGTH=1024,s.MAX_URL_LENGTH=2048,s.MAX_MESSAGE_LENGTH=32768,s.MAX_EXCEPTION_LENGTH=32768,s}(),se=function(){function s(){}return s.disableStorage=function(){s._canUseLocalStorage=!1,s._canUseSessionStorage=!1},s._getLocalStorageObject=function(){return s.canUseLocalStorage()?s._getVerifiedStorageObject(Q.LocalStorage):null},s._getVerifiedStorageObject=function(e){var t,n,i=null;try{if("undefined"==typeof window)return null;n=new Date,(i=e===Q.LocalStorage?window.localStorage:window.sessionStorage).setItem(n,n),t=i.getItem(n)!=n,i.removeItem(n),t&&(i=null)}catch(e){i=null}return i},s.isInternalApplicationInsightsEndpoint=function(e){return-1!==s._internalEndpoints.indexOf(e.toLowerCase())},s.canUseLocalStorage=function(){return void 0===s._canUseLocalStorage&&(s._canUseLocalStorage=!!s._getVerifiedStorageObject(Q.LocalStorage)),s._canUseLocalStorage},s.getStorage=function(t,e){var n=s._getLocalStorageObject();if(null!==n)try{return n.getItem(e)}catch(e){s._canUseLocalStorage=!1,t.throwInternal(g.WARNING,r,"Browser failed read of local storage. "+s.getExceptionName(e),{exception:s.dump(e)})}return null},s.setStorage=function(t,e,n){var i=s._getLocalStorageObject();if(null!==i)try{return i.setItem(e,n),!0}catch(e){s._canUseLocalStorage=!1,t.throwInternal(g.WARNING,a,"Browser failed write to local storage. "+s.getExceptionName(e),{exception:s.dump(e)})}return!1},s.removeStorage=function(t,e){var n=s._getLocalStorageObject();if(null!==n)try{return n.removeItem(e),!0}catch(e){s._canUseLocalStorage=!1,t.throwInternal(g.WARNING,l,"Browser failed removal of local storage item. "+s.getExceptionName(e),{exception:s.dump(e)})}return!1},s._getSessionStorageObject=function(){return s.canUseSessionStorage()?s._getVerifiedStorageObject(Q.SessionStorage):null},s.canUseSessionStorage=function(){return void 0===s._canUseSessionStorage&&(s._canUseSessionStorage=!!s._getVerifiedStorageObject(Q.SessionStorage)),s._canUseSessionStorage},s.getSessionStorageKeys=function(){var e=[];if(s.canUseSessionStorage())for(var t in window.sessionStorage)e.push(t);return e},s.getSessionStorage=function(t,e){var n=s._getSessionStorageObject();if(null!==n)try{return n.getItem(e)}catch(e){s._canUseSessionStorage=!1,t.throwInternal(g.WARNING,o,"Browser failed read of session storage. "+s.getExceptionName(e),{exception:s.dump(e)})}return null},s.setSessionStorage=function(t,e,n){var i=s._getSessionStorageObject();if(null!==i)try{return i.setItem(e,n),!0}catch(e){s._canUseSessionStorage=!1,t.throwInternal(g.WARNING,u,"Browser failed write to session storage. "+s.getExceptionName(e),{exception:s.dump(e)})}return!1},s.removeSessionStorage=function(t,e){var n=s._getSessionStorageObject();if(null!==n)try{return n.removeItem(e),!0}catch(e){s._canUseSessionStorage=!1,t.throwInternal(g.WARNING,f,"Browser failed removal of session storage item. "+s.getExceptionName(e),{exception:s.dump(e)})}return!1},s.disableCookies=function(){s._canUseCookies=!1},s.canUseCookies=function(t){if(void 0===s._canUseCookies){s._canUseCookies=!1;try{s._canUseCookies=void 0!==s.document.cookie}catch(e){t.throwInternal(g.WARNING,q,"Cannot access document.cookie - "+s.getExceptionName(e),{exception:s.dump(e)})}}return s._canUseCookies},s.setCookie=function(e,t,n,i){var r="",o="";i&&(r=";domain="+i),s.document.location&&"https:"===s.document.location.protocol&&(o=";secure"),s.canUseCookies(e)&&(s.document.cookie=t+"="+n+r+";path=/"+o)},s.stringToBoolOrDefault=function(e,t){return void 0===t&&(t=!1),null==e?t:"true"===e.toString().toLowerCase()},s.getCookie=function(e,t){if(s.canUseCookies(e)){var n="";if(t&&t.length)for(var i=t+"=",r=s.document.cookie.split(";"),o=0;o<r.length;o++){var a=r[o];if((a=s.trim(a))&&0===a.indexOf(i)){n=a.substring(i.length,r[o].length);break}}return n}},s.deleteCookie=function(e,t){s.canUseCookies(e)&&(s.document.cookie=t+"=;path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT;")},s.trim=function(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"")},s.newId=function(){for(var e="",t=1073741824*Math.random();0<t;){e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t%64),t=Math.floor(t/64)}return e},s.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},s.isError=function(e){return"[object Error]"===Object.prototype.toString.call(e)},s.isDate=function(e){return"[object Date]"===Object.prototype.toString.call(e)},s.toISOStringForIE8=function(e){if(s.isDate(e)){if(Date.prototype.toISOString)return e.toISOString();var t=function(e){var t=String(e);return 1===t.length&&(t="0"+t),t};return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+String((e.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}},s.getIEVersion=function(e){void 0===e&&(e=null);var t=e?e.toLowerCase():navigator.userAgent.toLowerCase();return-1!=t.indexOf("msie")?parseInt(t.split("msie")[1]):null},s.msToTimeSpan=function(e){(isNaN(e)||e<0)&&(e=0);var t=""+(e=Math.round(e))%1e3,n=""+Math.floor(e/1e3)%60,i=""+Math.floor(e/6e4)%60,r=""+Math.floor(e/36e5)%24,o=Math.floor(e/864e5);return t=1===t.length?"00"+t:2===t.length?"0"+t:t,n=n.length<2?"0"+n:n,i=i.length<2?"0"+i:i,(0<o?o+".":"")+(r=r.length<2?"0"+r:r)+":"+i+":"+n+"."+t},s.isCrossOriginError=function(e,t,n,i,r){return("Script error."===e||"Script error"===e)&&!r},s.dump=function(e){var t=Object.prototype.toString.call(e),n=JSON.stringify(e);return"[object Error]"===t&&(n="{ stack: '"+e.stack+"', message: '"+e.message+"', name: '"+e.name+"'"),t+n},s.getExceptionName=function(e){return"[object Error]"===Object.prototype.toString.call(e)?e.name:""},s.addEventHandler=function(e,t){if("undefined"==typeof window||!window||"string"!=typeof e||"function"!=typeof t)return!1;var n="on"+e;if(window.addEventListener)window.addEventListener(e,t,!1);else{if(!window.attachEvent)return!1;window.attachEvent(n,t)}return!0},s.IsBeaconApiSupported=function(){return"sendBeacon"in navigator&&navigator.sendBeacon},s.document="undefined"!=typeof document?document:{},s._canUseCookies=void 0,s._canUseLocalStorage=void 0,s._canUseSessionStorage=void 0,s._internalEndpoints=["https://dc.services.visualstudio.com/v2/track","https://breeze.aimon.applicationinsights.io/v2/track","https://dc-int.services.visualstudio.com/v2/track"],s.NotSpecified="not_specified",s}(),ue=function(){function i(){}return i.parseUrl=function(e){return i.htmlAnchorElement||(i.htmlAnchorElement=i.document.createElement?i.document.createElement("a"):{}),i.htmlAnchorElement.href=e,i.htmlAnchorElement},i.getAbsoluteUrl=function(e){var t,n=i.parseUrl(e);return n&&(t=n.href),t},i.getPathName=function(e){var t,n=i.parseUrl(e);return n&&(t=n.pathname),t},i.getCompleteUrl=function(e,t){return e?e.toUpperCase()+" "+t:t},i.document="undefined"!=typeof document?document:{},i}(),le=function(){function e(){}return e.ParseDependencyPath=function(e,t,n,i){var r,o;if(t&&0<t.length){var a=ue.parseUrl(t);if(r=a.host,null!=a.pathname)"/"!==(i=0===a.pathname.length?"/":a.pathname).charAt(0)&&(i="/"+i),o=ae.sanitizeString(e,n?n+" "+i:i);else o=ae.sanitizeString(e,t)}else o=r=i;return{target:r,name:o}},e}(),ce=(function(){function e(){}e.Now="undefined"==typeof window?function(){return(new Date).getTime()}:window.performance&&window.performance.now&&window.performance.timing?function(){return window.performance.now()+window.performance.timing.navigationStart}:function(){return(new Date).getTime()},e.GetDuration=function(e,t){var n=null;return 0===e||0===t||m.isNullOrUndefined(e)||m.isNullOrUndefined(t)||(n=t-e),n}}(),"ProcessLegacy"),fe="http.method",pe=function(e){function t(){return e.call(this)||this}return Z(t,e),t}(function(){}),de=function(r){function e(e,t,n){var i=r.call(this)||this;return i.name=ae.sanitizeString(e,n)||se.NotSpecified,i.data=t,i.time=se.toISOStringForIE8(new Date),i.aiDataContract={time:ee.Required,iKey:ee.Required,name:ee.Required,sampleRate:function(){return 100==i.sampleRate?ee.Hidden:ee.Required},tags:ee.Required,data:ee.Required},i}return Z(e,r),e}(function(){this.ver=1,this.sampleRate=100,this.tags={}}),he=function(){},ge=function(t){function e(){var e=t.call(this)||this;return e.ver=2,e.properties={},e.measurements={},e}return Z(e,t),e}(he),me=function(o){function e(e,t,n,i){var r=o.call(this)||this;return r.aiDataContract={ver:ee.Required,name:ee.Required,properties:ee.Default,measurements:ee.Default},r.name=ae.sanitizeString(e,t)||se.NotSpecified,r.properties=ae.sanitizeProperties(e,n),r.measurements=ae.sanitizeMeasurements(e,i),r}return Z(e,o),e.envelopeType="Microsoft.ApplicationInsights.{0}.Event",e.dataType="EventData",e}(ge),ve=function(){},ye=function(){this.hasFullStack=!0,this.parsedStack=[]},_e=function(a){function e(e,t,n,i,r){var o=a.call(this)||this;return o.aiDataContract={ver:ee.Required,exceptions:ee.Required,severityLevel:ee.Default,properties:ee.Default,measurements:ee.Default},o.properties=ae.sanitizeProperties(e,n),o.measurements=ae.sanitizeMeasurements(e,i),o.exceptions=[new Ie(e,t)],r&&(o.severityLevel=r),o}return Z(e,a),e.CreateSimpleException=function(e,t,n,i,r,o){return{exceptions:[{hasFullStack:!0,message:e,stack:r,typeName:t}]}},e.envelopeType="Microsoft.ApplicationInsights.{0}.Exception",e.dataType="ExceptionData",e}(function(t){function e(){var e=t.call(this)||this;return e.ver=2,e.exceptions=[],e.properties={},e.measurements={},e}return Z(e,t),e}(he)),Ie=function(r){function e(e,t){var n=r.call(this)||this;n.aiDataContract={id:ee.Default,outerId:ee.Default,typeName:ee.Required,message:ee.Required,hasFullStack:ee.Default,stack:ee.Default,parsedStack:ee.Array},n.typeName=ae.sanitizeString(e,t.name)||se.NotSpecified,n.message=ae.sanitizeMessage(e,t.message)||se.NotSpecified;var i=t.stack;return n.parsedStack=n.parseStack(i),n.stack=ae.sanitizeException(e,i),n.hasFullStack=se.isArray(n.parsedStack)&&0<n.parsedStack.length,n}return Z(e,r),e.prototype.parseStack=function(e){var t=void 0;if("string"==typeof e){var n=e.split("\n");t=[];for(var i=0,r=0,o=0;o<=n.length;o++){var a=n[o];if(Se.regex.test(a)){var s=new Se(n[o],i++);r+=s.sizeInBytes,t.push(s)}}if(32768<r)for(var u=0,l=t.length-1,c=0,f=u,p=l;u<l;){if(32768<(c+=t[u].sizeInBytes+t[l].sizeInBytes)){var d=p-f+1;t.splice(f,d);break}f=u,p=l,u++,l--}}return t},e}(ye),Se=function(r){function o(e,t){var n=r.call(this)||this;n.sizeInBytes=0,n.aiDataContract={level:ee.Required,method:ee.Required,assembly:ee.Default,fileName:ee.Default,line:ee.Default},n.level=t,n.method="<no_method>",n.assembly=se.trim(e);var i=e.match(o.regex);return i&&5<=i.length&&(n.method=se.trim(i[2])||n.method,n.fileName=se.trim(i[4]),n.line=parseInt(i[5])||0),n.sizeInBytes+=n.method.length,n.sizeInBytes+=n.fileName.length,n.sizeInBytes+=n.assembly.length,n.sizeInBytes+=o.baseSize,n.sizeInBytes+=n.level.toString().length,n.sizeInBytes+=n.line.toString().length,n}return Z(o,r),o.regex=/^([\s]+at)?(.*?)(\@|\s\(|\s)([^\(\@\n]+):([0-9]+):([0-9]+)(\)?)$/,o.baseSize=58,o}(ve),we=function(t){function e(){var e=t.call(this)||this;return e.ver=2,e.metrics=[],e.properties={},e}return Z(e,t),e}(he);(re=ie||(ie={}))[re.Measurement=0]="Measurement",re[re.Aggregation=1]="Aggregation";var be,Ee=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.aiDataContract={name:ee.Required,kind:ee.Default,value:ee.Required,count:ee.Default,min:ee.Default,max:ee.Default,stdDev:ee.Default},e}return Z(e,t),e}(function(){this.kind=ie.Measurement}),xe=function(l){function e(e,t,n,i,r,o,a){var s=l.call(this)||this;s.aiDataContract={ver:ee.Required,metrics:ee.Required,properties:ee.Default};var u=new Ee;return u.count=0<i?i:void 0,u.max=isNaN(o)||null===o?void 0:o,u.min=isNaN(r)||null===r?void 0:r,u.name=ae.sanitizeString(e,t)||se.NotSpecified,u.value=n,s.metrics=[u],s.properties=ae.sanitizeProperties(e,a),s}return Z(e,l),e.envelopeType="Microsoft.ApplicationInsights.{0}.Metric",e.dataType="MetricData",e}(we),Ne=function(t){function e(){var e=t.call(this)||this;return e.ver=2,e.properties={},e.measurements={},e}return Z(e,t),e}(ge),Te=function(u){function e(e,t,n,i,r,o,a){var s=u.call(this)||this;return s.aiDataContract={ver:ee.Required,name:ee.Default,url:ee.Default,duration:ee.Default,properties:ee.Default,measurements:ee.Default,id:ee.Default},s.id=ae.sanitizeId(e,a),s.url=ae.sanitizeUrl(e,n),s.name=ae.sanitizeString(e,t)||se.NotSpecified,isNaN(i)||(s.duration=se.msToTimeSpan(i)),s.properties=ae.sanitizeProperties(e,r),s.measurements=ae.sanitizeMeasurements(e,o),s}return Z(e,u),e.envelopeType="Microsoft.ApplicationInsights.{0}.Pageview",e.dataType="PageviewData",e}(Ne),Ce=function(d){function e(e,t,n,i,r,o,a,s,u,l,c){void 0===u&&(u="Ajax");var f=d.call(this)||this;f.aiDataContract={id:ee.Required,ver:ee.Required,name:ee.Default,resultCode:ee.Default,duration:ee.Default,success:ee.Default,data:ee.Default,target:ee.Default,type:ee.Default,properties:ee.Default,measurements:ee.Default,kind:ee.Default,value:ee.Default,count:ee.Default,min:ee.Default,max:ee.Default,stdDev:ee.Default,dependencyKind:ee.Default,dependencySource:ee.Default,commandName:ee.Default,dependencyTypeName:ee.Default},f.id=t,f.duration=se.msToTimeSpan(r),f.success=o,f.resultCode=a+"",f.type=ae.sanitizeString(e,u),f.data=ae.sanitizeUrl(e,i);var p=le.ParseDependencyPath(e,n,s,i);return f.target=p.target,f.name=p.name,f.properties=ae.sanitizeProperties(e,l),f.measurements=ae.sanitizeMeasurements(e,c),f}return Z(e,d),e.envelopeType="Microsoft.ApplicationInsights.{0}.RemoteDependency",e.dataType="RemoteDependencyData",e}(function(t){function e(){var e=t.call(this)||this;return e.ver=2,e.success=!0,e.properties={},e.measurements={},e}return Z(e,t),e}(he)),De=function(o){function e(e,t,n,i){var r=o.call(this)||this;return r.aiDataContract={ver:ee.Required,message:ee.Required,severityLevel:ee.Default,properties:ee.Default},t=t||se.NotSpecified,r.message=ae.sanitizeMessage(e,t),r.properties=ae.sanitizeProperties(e,i),n&&(r.severityLevel=n),r}return Z(e,o),e.envelopeType="Microsoft.ApplicationInsights.{0}.Message",e.dataType="MessageData",e}(function(t){function e(){var e=t.call(this)||this;return e.ver=2,e.properties={},e}return Z(e,t),e}(he)),Ae=function(d){function h(e,t,n,i,r,o){var a=d.call(this)||this;a.aiDataContract={ver:ee.Required,name:ee.Default,url:ee.Default,duration:ee.Default,perfTotal:ee.Default,networkConnect:ee.Default,sentRequest:ee.Default,receivedResponse:ee.Default,domProcessing:ee.Default,properties:ee.Default,measurements:ee.Default},a.isValid=!1;var s=h.getPerformanceTiming();if(s){var u=h.getDuration(s.navigationStart,s.loadEventEnd),l=h.getDuration(s.navigationStart,s.connectEnd),c=h.getDuration(s.requestStart,s.responseStart),f=h.getDuration(s.responseStart,s.responseEnd),p=h.getDuration(s.responseEnd,s.loadEventEnd);0==u?e.throwInternal(g.WARNING,y,"error calculating page view performance.",{total:u,network:l,request:c,response:f,dom:p}):h.shouldCollectDuration(u,l,c,f,p)?u<Math.floor(l)+Math.floor(c)+Math.floor(f)+Math.floor(p)?e.throwInternal(g.WARNING,v,"client performance math error.",{total:u,network:l,request:c,response:f,dom:p}):(a.durationMs=u,a.perfTotal=a.duration=se.msToTimeSpan(u),a.networkConnect=se.msToTimeSpan(l),a.sentRequest=se.msToTimeSpan(c),a.receivedResponse=se.msToTimeSpan(f),a.domProcessing=se.msToTimeSpan(p),a.isValid=!0):e.throwInternal(g.WARNING,N,"Invalid page load duration value. Browser perf data won't be sent.",{total:u,network:l,request:c,response:f,dom:p})}return a.url=ae.sanitizeUrl(e,n),a.name=ae.sanitizeString(e,t)||se.NotSpecified,a.properties=ae.sanitizeProperties(e,r),a.measurements=ae.sanitizeMeasurements(e,o),a}return Z(h,d),h.prototype.getIsValid=function(){return this.isValid},h.prototype.getDurationMs=function(){return this.durationMs},h.getPerformanceTiming=function(){return h.isPerformanceTimingSupported()?window.performance.timing:null},h.isPerformanceTimingSupported=function(){return"undefined"!=typeof window&&window.performance&&window.performance.timing},h.isPerformanceTimingDataReady=function(){var e=window.performance.timing;return 0<e.domainLookupStart&&0<e.navigationStart&&0<e.responseStart&&0<e.requestStart&&0<e.loadEventEnd&&0<e.responseEnd&&0<e.connectEnd&&0<e.domLoading},h.getDuration=function(e,t){var n=void 0;return isNaN(e)||isNaN(t)||(n=Math.max(t-e,0)),n},h.shouldCollectDuration=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=["googlebot","adsbot-google","apis-google","mediapartners-google"],i=navigator.userAgent,r=!1;if(i)for(var o=0;o<n.length;o++)r=r||-1!==i.toLowerCase().indexOf(n[o]);if(r)return!1;for(var a=0;a<e.length;a++)if(e[a]>=h.MAX_DURATION_ALLOWED)return!1;return!0},h.envelopeType="Microsoft.ApplicationInsights.{0}.PageviewPerformance",h.dataType="PageviewPerformanceData",h.MAX_DURATION_ALLOWED=36e5,h}(function(t){function e(){var e=t.call(this)||this;return e.ver=2,e.properties={},e.measurements={},e}return Z(e,t),e}(Ne)),Re=function(i){function e(e,t){var n=i.call(this)||this;return n.aiDataContract={baseType:ee.Required,baseData:ee.Required},n.baseType=e,n.baseData=t,n}return Z(e,i),e}(pe);(be=e.SeverityLevel||(e.SeverityLevel={}))[be.Verbose=0]="Verbose",be[be.Information=1]="Information",be[be.Warning=2]="Warning",be[be.Error=3]="Error",be[be.Critical=4]="Critical";var Le=function(){function e(){}return e.getConfig=function(e,t,n,i){var r;return void 0===i&&(i=!1),r=n&&e.extensionConfig&&e.extensionConfig[n]&&!m.isNullOrUndefined(e.extensionConfig[n][t])?e.extensionConfig[n][t]:e[t],m.isNullOrUndefined(r)?i:r},e}(),Me=new function(){this.applicationVersion="ai.application.ver",this.applicationBuild="ai.application.build",this.applicationTypeId="ai.application.typeId",this.applicationId="ai.application.applicationId",this.applicationLayer="ai.application.layer",this.deviceId="ai.device.id",this.deviceIp="ai.device.ip",this.deviceLanguage="ai.device.language",this.deviceLocale="ai.device.locale",this.deviceModel="ai.device.model",this.deviceFriendlyName="ai.device.friendlyName",this.deviceNetwork="ai.device.network",this.deviceNetworkName="ai.device.networkName",this.deviceOEMName="ai.device.oemName",this.deviceOS="ai.device.os",this.deviceOSVersion="ai.device.osVersion",this.deviceRoleInstance="ai.device.roleInstance",this.deviceRoleName="ai.device.roleName",this.deviceScreenResolution="ai.device.screenResolution",this.deviceType="ai.device.type",this.deviceMachineName="ai.device.machineName",this.deviceVMName="ai.device.vmName",this.deviceBrowser="ai.device.browser",this.deviceBrowserVersion="ai.device.browserVersion",this.locationIp="ai.location.ip",this.locationCountry="ai.location.country",this.locationProvince="ai.location.province",this.locationCity="ai.location.city",this.operationId="ai.operation.id",this.operationName="ai.operation.name",this.operationParentId="ai.operation.parentId",this.operationRootId="ai.operation.rootId",this.operationSyntheticSource="ai.operation.syntheticSource",this.operationCorrelationVector="ai.operation.correlationVector",this.sessionId="ai.session.id",this.sessionIsFirst="ai.session.isFirst",this.sessionIsNew="ai.session.isNew",this.userAccountAcquisitionDate="ai.user.accountAcquisitionDate",this.userAccountId="ai.user.accountId",this.userAgent="ai.user.userAgent",this.userId="ai.user.id",this.userStoreRegion="ai.user.storeRegion",this.userAuthUserId="ai.user.authUserId",this.userAnonymousUserAcquisitionDate="ai.user.anonUserAcquisitionDate",this.userAuthenticatedUserAcquisitionDate="ai.user.authUserAcquisitionDate",this.cloudName="ai.cloud.name",this.cloudRole="ai.cloud.role",this.cloudRoleVer="ai.cloud.roleVer",this.cloudRoleInstance="ai.cloud.roleInstance",this.cloudEnvironment="ai.cloud.environment",this.cloudLocation="ai.cloud.location",this.cloudDeploymentUnit="ai.cloud.deploymentUnit",this.internalNodeName="ai.internal.nodeName",this.internalSdkVersion="ai.internal.sdkVersion",this.internalAgentVersion="ai.internal.agentVersion"},Ue=function(){function e(e){this._config=e,this._buffer=[]}return e.prototype.enqueue=function(e){this._buffer.push(e)},e.prototype.count=function(){return this._buffer.length},e.prototype.clear=function(){this._buffer.length=0},e.prototype.getItems=function(){return this._buffer.slice(0)},e.prototype.batchPayloads=function(e){return e&&0<e.length?this._config.emitLineDelimitedJson()?e.join("\n"):"["+e.join(",")+"]":null},e.prototype.markAsSent=function(e){this.clear()},e.prototype.clearSent=function(e){},e}(),Oe=function(){function r(e,t){this._bufferFullMessageSent=!1,this._logger=e,this._config=t;var n=this.getBuffer(r.BUFFER_KEY),i=this.getBuffer(r.SENT_BUFFER_KEY);this._buffer=n.concat(i),this._buffer.length>r.MAX_BUFFER_SIZE&&(this._buffer.length=r.MAX_BUFFER_SIZE),this.setBuffer(r.SENT_BUFFER_KEY,[]),this.setBuffer(r.BUFFER_KEY,this._buffer)}return r.prototype.enqueue=function(e){this._buffer.length>=r.MAX_BUFFER_SIZE?this._bufferFullMessageSent||(this._logger.throwInternal(g.WARNING,B,"Maximum buffer size reached: "+this._buffer.length,!0),this._bufferFullMessageSent=!0):(this._buffer.push(e),this.setBuffer(r.BUFFER_KEY,this._buffer))},r.prototype.count=function(){return this._buffer.length},r.prototype.clear=function(){this._buffer.length=0,this.setBuffer(r.BUFFER_KEY,[]),this.setBuffer(r.SENT_BUFFER_KEY,[]),this._bufferFullMessageSent=!1},r.prototype.getItems=function(){return this._buffer.slice(0)},r.prototype.batchPayloads=function(e){return e&&0<e.length?this._config.emitLineDelimitedJson()?e.join("\n"):"["+e.join(",")+"]":null},r.prototype.markAsSent=function(e){this._buffer=this.removePayloadsFromBuffer(e,this._buffer),this.setBuffer(r.BUFFER_KEY,this._buffer);var t=this.getBuffer(r.SENT_BUFFER_KEY);t instanceof Array&&e instanceof Array&&((t=t.concat(e)).length>r.MAX_BUFFER_SIZE&&(this._logger.throwInternal(g.CRITICAL,B,"Sent buffer reached its maximum size: "+t.length,!0),t.length=r.MAX_BUFFER_SIZE),this.setBuffer(r.SENT_BUFFER_KEY,t))},r.prototype.clearSent=function(e){var t=this.getBuffer(r.SENT_BUFFER_KEY);t=this.removePayloadsFromBuffer(e,t),this.setBuffer(r.SENT_BUFFER_KEY,t)},r.prototype.removePayloadsFromBuffer=function(e,t){var n=[];for(var i in t){var r=!1;for(var o in e)if(e[o]===t[i]){r=!0;break}r||n.push(t[i])}return n},r.prototype.getBuffer=function(t){try{var e=se.getSessionStorage(this._logger,t);if(e){var n=JSON.parse(e);if(n)return n}}catch(e){this._logger.throwInternal(g.CRITICAL,E," storage key: "+t+", "+se.getExceptionName(e),{exception:se.dump(e)})}return[]},r.prototype.setBuffer=function(t,e){try{var n=JSON.stringify(e);se.setSessionStorage(this._logger,t,n)}catch(e){se.setSessionStorage(this._logger,t,JSON.stringify([])),this._logger.throwInternal(g.WARNING,b," storage key: "+t+", "+se.getExceptionName(e)+". Buffer cleared",{exception:se.dump(e)})}},r.BUFFER_KEY="AI_buffer",r.SENT_BUFFER_KEY="AI_sentBuffer",r.MAX_BUFFER_SIZE=2e3,r}(),Pe=function(){function a(){}return a.extractProperties=function(e){var t=null;for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];"number"!=typeof i&&(t||(t={}),t[n]=i)}return t},a.extractPropsAndMeasurements=function(e,t,n){if(!m.isNullOrUndefined(e))for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];"number"==typeof r?n[i]=r:t[i]="string"==typeof r?r:JSON.stringify(r)}},a.createEnvelope=function(e,t,n,i){var r=new de(e,i,t);r.iKey=n.iKey;var o=n.iKey.replace(/-/g,"");return r.name=r.name.replace("{0}",o),a.extractPartAExtensions(n,r),n.tags||(n.tags=[]),r},a.extractPartAExtensions=function(e,t){if(t.tags||(t.tags=[]),e.ext||(e.ext={}),e.tags||(e.tags=[]),e.ext.user){e.ext.user.authId&&(t.tags[Me.userAuthUserId]=e.ext.user.authId);var n=e.ext.user.id||e.ext.user.localId;n&&(t.tags[Me.userId]=n)}if(e.ext.app&&e.ext.app.sesId&&(t.tags[Me.sessionId]=e.ext.app.sesId),e.ext.device&&((e.ext.device.id||e.ext.device.localId)&&(t.tags[Me.deviceId]=e.ext.device.id||e.ext.device.localId),e.ext.device.ip&&(t.tags[Me.deviceIp]=e.ext.device.ip)),e.ext.web){var i=e.ext.web;i.browserLang&&(t.tags[Me.deviceLanguage]=i.browserLang),i.browserVer&&(t.tags[Me.deviceBrowserVersion]=i.browserVer),i.browser&&(t.tags[Me.deviceBrowser]=i.browser),t.data=t.data||{},t.data.baseData=t.data.baseData||{},t.data.baseData.properties=t.data.baseData.properties||{},i.domain&&(t.data.baseData.properties.domain=i.domain),i.isManual&&(t.data.baseData.properties.isManual=i.isManual.toString()),i.screenRes&&(t.data.baseData.properties.screenRes=i.screenRes),i.userConsent&&(t.data.baseData.properties.userConsent=i.userConsent.toString())}e.ext.device&&e.ext.device.model&&(t.tags[Me.deviceModel]=e.ext.device.model),e.ext.os&&e.ext.os.name&&(t.tags[Me.deviceOS]=e.ext.os.name),e.ext.device&&e.ext.device.deviceType&&(t.tags[Me.deviceType]=e.ext.device.deviceType),e.ext.trace&&(e.ext.trace.parentID&&(t.tags[Me.operationParentId]=e.ext.trace.parentID),e.ext.trace.name&&(t.tags[Me.operationName]=e.ext.trace.name),e.ext.trace.traceID&&(t.tags[Me.operationId]=e.ext.trace.traceID));var r={};e.tags.forEach(function(e){r=ne({},r,e)}),t.tags=ne({},t.tags,r)},a}(),ze=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Z(t,e),t.prototype.Create=function(e,t){this._logger=e,m.isNullOrUndefined(t.baseData)&&this._logger.throwInternal(g.CRITICAL,T,"telemetryItem.baseData cannot be null.");var n={},i={};Pe.extractPropsAndMeasurements(t.data,i,n);var r=t.baseData;if(m.isNullOrUndefined(r))return e.warnToConsole("Invalid input for dependency data"),null;var o=r.id,a=r.target,s=r.name,u=r.duration,l=r.success,c=r.responseCode,f=r.type,p=r.properties&&r.properties[fe]?r.properties[fe]:"GET",d=new Ce(e,o,a,s,u,l,c,p,f,i,n),h=new Re(Ce.dataType,d);return Pe.createEnvelope(e,Ce.envelopeType,t,h)},t.DependencyEnvelopeCreator=new t,t}(Pe),ke=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Z(t,e),t.prototype.Create=function(e,t){this._logger=e,m.isNullOrUndefined(t.baseData)&&this._logger.throwInternal(g.CRITICAL,T,"telemetryItem.baseData cannot be null.");var n={},i={};t.baseType!==me.dataType&&(n.baseTypeSource=t.baseType),t.baseType===me.dataType?(n=t.baseData.properties||{},i=t.baseData.measurements||{}):t.baseData&&Pe.extractPropsAndMeasurements(t.baseData,n,i),Pe.extractPropsAndMeasurements(t.data,n,i);var r=t.baseData.name,o=new me(e,r,n,i),a=new Re(me.dataType,o);return Pe.createEnvelope(e,me.envelopeType,t,a)},t.EventEnvelopeCreator=new t,t}(Pe),Be=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Z(t,e),t.prototype.Create=function(e,t){this._logger=e,m.isNullOrUndefined(t.baseData)&&this._logger.throwInternal(g.CRITICAL,T,"telemetryItem.baseData cannot be null.");var n=t.baseData,i=new Re(_e.dataType,n);return Pe.createEnvelope(e,_e.envelopeType,t,i)},t.ExceptionEnvelopeCreator=new t,t}(Pe),qe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Z(t,e),t.prototype.Create=function(e,t){this._logger=e,m.isNullOrUndefined(t.baseData)&&this._logger.throwInternal(g.CRITICAL,T,"telemetryItem.baseData cannot be null.");var n=Pe.extractProperties(t.data),i=t.baseData.name,r=t.baseData.average,o=t.baseData.sampleCount,a=t.baseData.min,s=t.baseData.max,u=new xe(e,i,r,o,a,s,n),l=new Re(xe.dataType,u);return Pe.createEnvelope(e,xe.envelopeType,t,l)},t.MetricEnvelopeCreator=new t,t}(Pe),Ve=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Z(t,e),t.prototype.Create=function(e,t){this._logger=e,m.isNullOrUndefined(t.baseData)&&this._logger.throwInternal(g.CRITICAL,T,"telemetryItem.baseData cannot be null.");var n=void 0;m.isNullOrUndefined(t.baseData)||m.isNullOrUndefined(t.baseData.properties)||(n=t.baseData.properties.duration,delete t.baseData.properties.duration);var i=t.baseData,r=i.name,o=i.uri,a=i.id,s=i.properties||{},u=i.measurements||{};if(m.isNullOrUndefined(i.refUri)||(s.refUri=i.refUri),m.isNullOrUndefined(i.pageType)||(s.pageType=i.pageType),m.isNullOrUndefined(i.isLoggedIn)||(s.isLoggedIn=i.isLoggedIn.toString()),!m.isNullOrUndefined(i.properties)){var l=i.properties;for(var c in l)l.hasOwnProperty(c)&&(s[c]=l[c])}var f=new Te(e,r,o,n,s,u,a),p=new Re(Te.dataType,f);return Pe.createEnvelope(e,Te.envelopeType,t,p)},t.PageViewEnvelopeCreator=new t,t}(Pe),Fe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Z(t,e),t.prototype.Create=function(e,t){this._logger=e,m.isNullOrUndefined(t.baseData)&&this._logger.throwInternal(g.CRITICAL,T,"telemetryItem.baseData cannot be null.");var n=t.baseData,i=n.name,r=n.url,o=n.properties,a=n.measurements,s=new Ae(e,i,r,void 0,o,a),u=new Re(Ae.dataType,s);return Pe.createEnvelope(e,Ae.envelopeType,t,u)},t.PageViewPerformanceEnvelopeCreator=new t,t}(Pe),Ge=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Z(t,e),t.prototype.Create=function(e,t){this._logger=e,m.isNullOrUndefined(t.baseData)&&this._logger.throwInternal(g.CRITICAL,T,"telemetryItem.baseData cannot be null.");var n=t.baseData.message,i=t.baseData.severityLevel,r=Pe.extractProperties(t.data),o=ne({},r,t.baseData.properties),a=new De(e,n,i,o),s=new Re(De.dataType,a);return Pe.createEnvelope(e,De.envelopeType,t,s)},t.TraceEnvelopeCreator=new t,t}(Pe),Xe=function(){function e(){}return e.prototype.Validate=function(e){return!0},e.EventValidator=new e,e}(),He=function(){function e(){}return e.prototype.Validate=function(e){return!0},e.TraceValidator=new e,e}(),je=function(){function e(){}return e.prototype.Validate=function(e){return!0},e._validateExceptions=function(e){return!0},e.ExceptionValidator=new e,e}(),Ke=function(){function e(){}return e.prototype.Validate=function(e){return!0},e.MetricValidator=new e,e}(),We=function(){function e(){}return e.prototype.Validate=function(e){return!0},e.PageViewPerformanceValidator=new e,e}(),Ye=function(){function e(){}return e.prototype.Validate=function(e){return!0},e.PageViewValidator=new e,e}(),Je=function(){function e(){}return e.prototype.Validate=function(e){return!0},e.RemoteDepdencyValidator=new e,e}(),Ze=function(){function e(e){this._logger=e}return e.prototype.serialize=function(e){var t=this._serializeObject(e,"root");return JSON.stringify(t)},e.prototype._serializeObject=function(e,t){var n="__aiCircularRefCheck",i={};if(!e)return this._logger.throwInternal(g.CRITICAL,D,"cannot serialize object because it is null or undefined",{name:t},!0),i;if(e[n])return this._logger.throwInternal(g.WARNING,R,"Circular reference detected while serializing object",{name:t},!0),i;if(!e.aiDataContract){if("measurements"===t)i=this._serializeStringMap(e,"number",t);else if("properties"===t)i=this._serializeStringMap(e,"string",t);else if("tags"===t)i=this._serializeStringMap(e,"string",t);else if(se.isArray(e))i=this._serializeArray(e,t);else{this._logger.throwInternal(g.WARNING,A,"Attempting to serialize an object which does not implement ISerializable",{name:t},!0);try{JSON.stringify(e),i=e}catch(e){this._logger.throwInternal(g.CRITICAL,D,e&&"function"==typeof e.toString?e.toString():"Error serializing object",null,!0)}}return i}for(var r in e[n]=!0,e.aiDataContract){var o,a=e.aiDataContract[r],s="function"==typeof a?a()&ee.Required:a&ee.Required,u="function"==typeof a?a()&ee.Hidden:a&ee.Hidden,l=a&ee.Array,c=void 0!==e[r],f="object"==typeof e[r]&&null!==e[r];if(!s||c||l){if(!u)void 0!==(o=f?l?this._serializeArray(e[r],r):this._serializeObject(e[r],r):e[r])&&(i[r]=o)}else this._logger.throwInternal(g.CRITICAL,_,"Missing required field specification. The field is required but not present on source",{field:r,name:t})}return delete e[n],i},e.prototype._serializeArray=function(e,t){var n=void 0;if(e)if(se.isArray(e)){n=[];for(var i=0;i<e.length;i++){var r=e[i],o=this._serializeObject(r,t+"["+i+"]");n.push(o)}}else this._logger.throwInternal(g.CRITICAL,M,"This field was specified as an array in the contract but the item is not an array.\r\n",{name:t},!0);return n},e.prototype._serializeStringMap=function(e,t,n){var i=void 0;if(e)for(var r in i={},e){var o=e[r];if("string"===t)void 0===o?i[r]="undefined":null===o?i[r]="null":o.toString?i[r]=o.toString():i[r]="invalid field: toString() is not defined.";else if("number"===t)if(void 0===o)i[r]="undefined";else if(null===o)i[r]="null";else{var a=parseFloat(o);isNaN(a)?i[r]="NaN":i[r]=a}else i[r]="invalid field: "+n+" is of unknown type.",this._logger.throwInternal(g.CRITICAL,i[r],null,!0)}return i},e}(),Qe=function(){function e(){this._onlineStatus=!0;try{"undefined"==typeof window?this.isListening=!1:window&&window.addEventListener?(window.addEventListener("online",this._setOnline.bind(this),!1),window.addEventListener("offline",this._setOffline.bind(this),!1),this.isListening=!0):document&&document.body?(document.body.ononline=this._setOnline.bind(this),document.body.onoffline=this._setOffline.bind(this),this.isListening=!0):document?(document.ononline=this._setOnline.bind(this),document.onoffline=this._setOffline.bind(this),this.isListening=!0):this.isListening=!1}catch(e){this.isListening=!1}}return e.prototype._setOnline=function(){this._onlineStatus=!0},e.prototype._setOffline=function(){this._onlineStatus=!1},e.prototype.isOnline=function(){return this.isListening?this._onlineStatus:!navigator||navigator.onLine},e.prototype.isOffline=function(){return!this.isOnline()},e.Offline=new e,e}().Offline,$e=function(){function u(){this.priority=1001,this._XMLHttpRequestSupported=!1,this.identifier="AppInsightsChannelPlugin"}return u.prototype.pause=function(){throw new Error("Method not implemented.")},u.prototype.resume=function(){throw new Error("Method not implemented.")},u.prototype.flush=function(){try{this.triggerSend()}catch(e){this._logger.throwInternal(g.CRITICAL,d,"flush failed, telemetry will not be collected: "+se.getExceptionName(e),{exception:se.dump(e)})}},u.prototype.teardown=function(){throw new Error("Method not implemented.")},u.prototype.initialize=function(t,e,n){var i=this;this._logger=e.logger,this._serializer=new Ze(e.logger),this._consecutiveErrors=0,this._retryAt=null,this._lastSend=0,this._sender=null;var r=u._getDefaultAppInsightsChannelConfig();this._config=u._getEmptyAppInsightsChannelConfig();var o=function(e){a._config[e]=function(){return Le.getConfig(t,e,i.identifier,r[e]())}},a=this;for(var s in r)o(s);(this._buffer=this._config.enableSessionStorageBuffer&&se.canUseSessionStorage()?new Oe(this._logger,this._config):new Ue(this._config),!this._config.isBeaconApiDisabled()&&se.IsBeaconApiSupported())?this._sender=this._beaconSender:"undefined"!=typeof XMLHttpRequest&&("withCredentials"in new XMLHttpRequest?(this._sender=this._xhrSender,this._XMLHttpRequestSupported=!0):"undefined"!=typeof XDomainRequest&&(this._sender=this._xdrSender))},u.prototype.processTelemetry=function(e){var t=this;try{if(this._config.disableTelemetry())return;if(!e)return void this._logger.throwInternal(g.CRITICAL,s,"Cannot send empty telemetry");if(!this._sender)return void this._logger.throwInternal(g.CRITICAL,S,"Sender was not initialized");if(!u._validate(e))return void this._logger.throwInternal(g.CRITICAL,T,"Invalid telemetry envelope");var n=u.constructEnvelope(e,this._config.instrumentationKey(),this._logger);if(!n)return void this._logger.throwInternal(g.CRITICAL,C,"Unable to create an AppInsights envelope");var i=!1;if(e.tags&&e.tags[ce]&&(e.tags[ce].forEach(function(e){try{e&&!1===e(n)&&(i=!0,t._logger.warnToConsole("Telemetry processor check returns false"))}catch(e){t._logger.throwInternal(g.CRITICAL,z,"One of telemetry initializers failed, telemetry item will not be sent: "+se.getExceptionName(e),{exception:se.dump(e)},!0)}}),delete e.tags[ce]),i)return;var r=this._serializer.serialize(n),o=this._buffer.getItems(),a=this._buffer.batchPayloads(o);a&&a.length+r.length>this._config.maxBatchSizeInBytes()&&this.triggerSend(),this._buffer.enqueue(r),this._setupTimer()}catch(e){this._logger.throwInternal(g.WARNING,p,"Failed adding telemetry to the sender's buffer, some telemetry will be lost: "+se.getExceptionName(e),{exception:se.dump(e)})}m.isNullOrUndefined(this._nextPlugin)||this._nextPlugin.processTelemetry(e)},u.prototype.setNextPlugin=function(e){this._nextPlugin=e},u.prototype._xhrReadyStateChange=function(e,t,n){if(4===e.readyState){var i=null;if(this._appId||(i=this._parseResponse(e.responseText||e.response))&&i.appId&&(this._appId=i.appId),(e.status<200||300<=e.status)&&0!==e.status)!this._config.isRetryDisabled()&&this._isRetriable(e.status)?(this._resendPayload(t),this._logger.throwInternal(g.WARNING,w,". Response code "+e.status+". Will retry to send "+t.length+" items.")):this._onError(t,this._formatErrorMessageXhr(e));else if(Qe.isOffline()){if(!this._config.isRetryDisabled()){this._resendPayload(t,10),this._logger.throwInternal(g.WARNING,w,". Offline - Response Code: "+e.status+". Offline status: "+Qe.isOffline()+". Will retry to send "+t.length+" items.")}}else 206===e.status?(i||(i=this._parseResponse(e.responseText||e.response)),i&&!this._config.isRetryDisabled()?this._onPartialSuccess(t,i):this._onError(t,this._formatErrorMessageXhr(e))):(this._consecutiveErrors=0,this._onSuccess(t,n))}},u.prototype.triggerSend=function(e){void 0===e&&(e=!0);try{if(this._config.disableTelemetry())this._buffer.clear();else{if(0<this._buffer.count()){var t=this._buffer.getItems();this._sender(t,e)}this._lastSend=+new Date}clearTimeout(this._timeoutHandle),this._timeoutHandle=null,this._retryAt=null}catch(e){(!se.getIEVersion()||9<se.getIEVersion())&&this._logger.throwInternal(g.CRITICAL,w,"Telemetry transmission failed, some telemetry will be lost: "+se.getExceptionName(e),{exception:se.dump(e)})}},u.prototype._onError=function(e,t,n){this._logger.throwInternal(g.WARNING,I,"Failed to send telemetry.",{message:t}),this._buffer.clearSent(e)},u.prototype._onPartialSuccess=function(e,t){for(var n=[],i=[],r=0,o=t.errors.reverse();r<o.length;r++){var a=o[r],s=e.splice(a.index,1)[0];this._isRetriable(a.statusCode)?i.push(s):n.push(s)}0<e.length&&this._onSuccess(e,t.itemsAccepted),0<n.length&&this._onError(n,this._formatErrorMessageXhr(null,["partial success",t.itemsAccepted,"of",t.itemsReceived].join(" "))),0<i.length&&(this._resendPayload(i),this._logger.throwInternal(g.WARNING,w,"Partial success. Delivered: "+e.length+", Failed: "+n.length+". Will retry to send "+i.length+" our of "+t.itemsReceived+" items"))},u.prototype._onSuccess=function(e,t){this._buffer.clearSent(e)},u.prototype._xdrOnLoad=function(e,t){if(!e||e.responseText+""!="200"&&""!==e.responseText){var n=this._parseResponse(e.responseText);n&&n.itemsReceived&&n.itemsReceived>n.itemsAccepted&&!this._config.isRetryDisabled()?this._onPartialSuccess(t,n):this._onError(t,this._formatErrorMessageXdr(e))}else this._consecutiveErrors=0,this._onSuccess(t,0)},u.constructEnvelope=function(e,t,n){var i;switch((i=t===e.iKey||m.isNullOrUndefined(t)?e:ne({},e,{iKey:t})).baseType){case me.dataType:return ke.EventEnvelopeCreator.Create(n,i);case De.dataType:return Ge.TraceEnvelopeCreator.Create(n,i);case Te.dataType:return Ve.PageViewEnvelopeCreator.Create(n,i);case Ae.dataType:return Fe.PageViewPerformanceEnvelopeCreator.Create(n,i);case _e.dataType:return Be.ExceptionEnvelopeCreator.Create(n,i);case xe.dataType:return qe.MetricEnvelopeCreator.Create(n,i);case Ce.dataType:return ze.DependencyEnvelopeCreator.Create(n,i);default:return ke.EventEnvelopeCreator.Create(n,i)}},u._getDefaultAppInsightsChannelConfig=function(){var e={endpointUrl:function(){return"https://dc.services.visualstudio.com/v2/track"},emitLineDelimitedJson:function(){return!1},maxBatchInterval:function(){return 15e3},maxBatchSizeInBytes:function(){return 102400},disableTelemetry:function(){return!1},enableSessionStorageBuffer:function(){return!0},isRetryDisabled:function(){return!1},isBeaconApiDisabled:function(){return!0},instrumentationKey:function(){}};return e},u._getEmptyAppInsightsChannelConfig=function(){return{endpointUrl:void 0,emitLineDelimitedJson:void 0,maxBatchInterval:void 0,maxBatchSizeInBytes:void 0,disableTelemetry:void 0,enableSessionStorageBuffer:void 0,isRetryDisabled:void 0,isBeaconApiDisabled:void 0,instrumentationKey:void 0}},u._validate=function(e){switch(e.baseType){case me.dataType:return Xe.EventValidator.Validate(e);case De.dataType:return He.TraceValidator.Validate(e);case _e.dataType:return je.ExceptionValidator.Validate(e);case xe.dataType:return Ke.MetricValidator.Validate(e);case Te.dataType:return Ye.PageViewValidator.Validate(e);case Ae.dataType:return We.PageViewPerformanceValidator.Validate(e);case Ce.dataType:return Je.RemoteDepdencyValidator.Validate(e);default:return Xe.EventValidator.Validate(e)}},u.prototype._beaconSender=function(e,t){var n=this._config.endpointUrl(),i=this._buffer.batchPayloads(e),r=new Blob([i],{type:"text/plain;charset=UTF-8"});navigator.sendBeacon(n,r)?this._buffer.markAsSent(e):this._logger.throwInternal(g.CRITICAL,w,". Failed to send telemetry with Beacon API.")},u.prototype._xhrSender=function(t,e){var n=this,i=new XMLHttpRequest;i.Microsoft_ApplicationInsights_BypassAjaxInstrumentation=!0,i.open("POST",this._config.endpointUrl(),e),i.setRequestHeader("Content-type","application/json"),se.isInternalApplicationInsightsEndpoint(this._config.endpointUrl())&&i.setRequestHeader(oe.sdkContextHeader,oe.sdkContextHeaderAppIdRequest),i.onreadystatechange=function(){return n._xhrReadyStateChange(i,t,t.length)},i.onerror=function(e){return n._onError(t,n._formatErrorMessageXhr(i),e)};var r=this._buffer.batchPayloads(t);i.send(r),this._buffer.markAsSent(t)},u.prototype._parseResponse=function(t){try{if(t&&""!==t){var e=JSON.parse(t);if(e&&e.itemsReceived&&e.itemsReceived>=e.itemsAccepted&&e.itemsReceived-e.itemsAccepted==e.errors.length)return e}}catch(e){this._logger.throwInternal(g.CRITICAL,x,"Cannot parse the response. "+se.getExceptionName(e),{response:t})}return null},u.prototype._resendPayload=function(e,t){if(void 0===t&&(t=1),e&&0!==e.length){this._buffer.clearSent(e),this._consecutiveErrors++;for(var n=0,i=e;n<i.length;n++){var r=i[n];this._buffer.enqueue(r)}this._setRetryTime(t),this._setupTimer()}},u.prototype._setRetryTime=function(e){var t;if(this._consecutiveErrors<=1)t=10;else{var n=(Math.pow(2,this._consecutiveErrors)-1)/2,i=Math.floor(Math.random()*n*10)+1;i*=e,t=Math.max(Math.min(i,3600),10)}var r=Date.now()+1e3*t;this._retryAt=r},u.prototype._setupTimer=function(){var e=this;if(!this._timeoutHandle){var t=this._retryAt?Math.max(0,this._retryAt-Date.now()):0,n=Math.max(this._config.maxBatchInterval(),t);this._timeoutHandle=setTimeout(function(){e.triggerSend()},n)}},u.prototype._isRetriable=function(e){return 408==e||429==e||500==e||503==e},u.prototype._formatErrorMessageXhr=function(e,t){return e?"XMLHttpRequest,Status:"+e.status+",Response:"+e.responseText||e.response||"":t},u.prototype._xdrSender=function(t,e){var n=this,i=new XDomainRequest;i.onload=function(){return n._xdrOnLoad(i,t)},i.onerror=function(e){return n._onError(t,n._formatErrorMessageXdr(i),e)};var r=window.location.protocol;if(0!==this._config.endpointUrl().lastIndexOf(r,0))return this._logger.throwInternal(g.WARNING,w,". Cannot send XDomain request. The endpoint URL protocol doesn't match the hosting page protocol."),void this._buffer.clear();var o=this._config.endpointUrl().replace(/^(https?:)/,"");i.open("POST",o);var a=this._buffer.batchPayloads(t);i.send(a),this._buffer.markAsSent(t)},u.prototype._formatErrorMessageXdr=function(e,t){return e?"XDomainRequest,Response:"+e.responseText||"":t},u}(),et=function(){function e(e){if(m.isNullOrUndefined(e)||m.isNullOrUndefined(e.instrumentationKey))throw new Error("Invalid input configuration");this.config=e,this.getSKUDefaults(),this.initialize()}return e.prototype.initialize=function(){this.core=new X;var e=[],t=new $e;e.push(t),this.core.initialize(this.config,e),t.initialize(this.config,this.core,e),this.pollInternalLogs()},e.prototype.track=function(e){this.core.track(e)},e.prototype.flush=function(t){void 0===t&&(t=!0),this.core.getTransmissionControls().forEach(function(e){e.forEach(function(e){t?e.flush():e.triggerSend(t)})})},e.prototype.pollInternalLogs=function(){this.core.pollInternalLogs()},e.prototype.getSKUDefaults=function(){this.config.diagnosticLogInterval=this.config.diagnosticLogInterval&&0<this.config.diagnosticLogInterval?this.config.diagnosticLogInterval:1e4},e}();e.ApplicationInsights=et,e.AppInsightsCore=X,e.CoreUtils=m,e.Sender=$e,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=aib.1.min.js.map
